external ast_const: real -> ast
external ast_add: ast -> ast -> ast

type Latent
type LatentG
type LatentG_original

type Previous_trace_type
type Previous_trace_typeG

proc Pcfg() -> ast | old : Previous_trace_type | lat : Latent = {
  _ <- sample{old}(BETA(3; 1));
  k <- sample{lat}(BETA(3; 1));
  PcfgGen(k)
}

proc PcfgGen_original(k: ureal) -> ast | . | lat : LatentG_original = {
  u <- sample{lat}(UNIF);
  if{lat} . then
    v <- sample{lat}(NORMAL(0; 1));
    return ast_const(v)
  else
    lhs <- PcfgGen_original(k);
    rhs <- PcfgGen_original(k);
    return ast_add(lhs)(rhs)
}

proc PcfgGen(k: ureal) -> ast | old: Previous_trace_typeG | lat : LatentG = {
  _ <- observe{old}(UNIF);
  u <- sample{lat}(UNIF);
  if{lat} . then
    if{old} . then 
      _ <- observe{old}(NORMAL(0; 1));
      v <- sample{lat}(SAME(real));
      return ast_const(v)
    else
      v <- sample{lat}(NORMAL(0; 1));
      return ast_const(v)
  else
    if{old} . then
      lhs <- PcfgGen(k);
      rhs <- PcfgGen(k);
      return ast_add(lhs)(rhs)
    else
      lhs <- PcfgGen_original(k);
      rhs <- PcfgGen_original(k);
      return ast_add(lhs)(rhs)
}
